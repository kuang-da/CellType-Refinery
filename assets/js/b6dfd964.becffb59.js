"use strict";(globalThis.webpackChunkcelltype_refinery_docs=globalThis.webpackChunkcelltype_refinery_docs||[]).push([[1826],{4601(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"core-workflows/hybrid-workflow","title":"Hybrid Workflow","description":"The hybrid workflow combines automatic baseline annotation with targeted manual corrections.","source":"@site/docs/core-workflows/hybrid-workflow.md","sourceDirName":"core-workflows","slug":"/core-workflows/hybrid-workflow","permalink":"/CellType-Refinery/docs/core-workflows/hybrid-workflow","draft":false,"unlisted":false,"editUrl":"https://github.com/kuang-da/CellType-Refinery/tree/main/celltype-refinery-docs/docs/core-workflows/hybrid-workflow.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Expert Curation Workflow","permalink":"/CellType-Refinery/docs/core-workflows/expert-curation"},"next":{"title":"Iterative Refinement Workflow","permalink":"/CellType-Refinery/docs/core-workflows/iterative-refinement"}}');var l=r(4848),t=r(8453);const o={sidebar_position:4},s="Hybrid Workflow",a={},c=[{value:"Overview",id:"overview",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"Architecture",id:"architecture",level:2},{value:"CLI Usage",id:"cli-usage",level:2},{value:"Python API",id:"python-api",level:2},{value:"Example Configuration",id:"example-configuration",level:2},{value:"Auto Policy Defaults",id:"auto-policy-defaults",level:3},{value:"Manual Overrides",id:"manual-overrides",level:3},{value:"Merge Behavior",id:"merge-behavior",level:2},{value:"Diagnostic Mode",id:"diagnostic-mode",level:2},{value:"Workflow Example",id:"workflow-example",level:2},{value:"Step 1: Run Auto + Diagnostic",id:"step-1-run-auto--diagnostic",level:3},{value:"Step 2: Create Manual Config",id:"step-2-create-manual-config",level:3},{value:"Step 3: Execute Hybrid",id:"step-3-execute-hybrid",level:3},{value:"Step 4: Review and Iterate",id:"step-4-review-and-iterate",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"hybrid-workflow",children:"Hybrid Workflow"})}),"\n",(0,l.jsx)(n.p,{children:"The hybrid workflow combines automatic baseline annotation with targeted manual corrections."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.mermaid,{value:"flowchart TB\n    A[Input Data] --\x3e B[Clustering]\n    B --\x3e C[Annotation]\n    C --\x3e D[Auto Policy]\n    D --\x3e E[base_plan]\n\n    F[Manual Config] --\x3e G[Manual Policy]\n    G --\x3e H[overlay_plan]\n\n    E --\x3e I[Merge Plans]\n    H --\x3e I\n    I --\x3e J[merged_plan]\n    J --\x3e K[Execute]\n    K --\x3e L[Results]"}),"\n",(0,l.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"You want automatic baseline with specific corrections"}),"\n",(0,l.jsx)(n.li,{children:"Some cell types need manual attention"}),"\n",(0,l.jsx)(n.li,{children:"You need reproducible, auditable results"}),"\n",(0,l.jsx)(n.li,{children:"Time is limited but accuracy matters"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,l.jsx)(n.p,{children:"The hybrid workflow uses a policy-based system:"}),"\n",(0,l.jsx)(n.mermaid,{value:"flowchart LR\n    subgraph Policies\n        AUTO[AutoPolicy] --\x3e BP[base_plan]\n        MANUAL[ManualPolicy] --\x3e OP[overlay_plan]\n    end\n\n    BP --\x3e MERGE[merge_plans]\n    OP --\x3e MERGE\n    MERGE --\x3e MERGED[merged_plan]\n    MERGED --\x3e ENGINE[RefinementEngine]\n    ENGINE --\x3e OUTPUT[refined.h5ad]"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Merge Rule"}),": Manual operations override automatic ones for the same cluster."]}),"\n",(0,l.jsx)(n.h2,{id:"cli-usage",children:"CLI Usage"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Run with both auto and manual config\ncelltype-refinery refine \\\n  --input annotated.h5ad \\\n  --auto \\\n  --config curation.yaml \\\n  --execute \\\n  --out output/hybrid\n"})}),"\n",(0,l.jsx)(n.h2,{id:"python-api",children:"Python API"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from celltype_refinery.core.refinement import RefinementEngine\nfrom celltype_refinery.core.refinement.policies import AutoPolicy, ManualPolicy\n\n# Load data\nengine = RefinementEngine()\nengine.load(adata)\n\n# Create auto plan\nauto_policy = AutoPolicy(score_threshold=1.0, min_cells=500)\nbase_plan = auto_policy.generate(engine.context)\n\n# Create manual plan\nmanual_policy = ManualPolicy.from_yaml("curation.yaml")\noverlay_plan = manual_policy.generate(engine.context)\n\n# Merge plans (manual overrides auto)\nmerged_plan = engine.merge_plans(base_plan, overlay_plan)\n\n# Execute\nengine.execute(merged_plan)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"auto-policy-defaults",children:"Auto Policy Defaults"}),"\n",(0,l.jsx)(n.p,{children:"The automatic policy generates:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"SUBCLUSTER"})," for low-scoring clusters (score < 1.0)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"SKIP"})," for high-confidence clusters (score > 1.0)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"RELABEL"})," for leaf nodes with good scores"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"manual-overrides",children:"Manual Overrides"}),"\n",(0,l.jsx)(n.p,{children:"Your config overrides auto decisions:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# curation.yaml\nversion: "1.0"\n\n# Override auto\'s SUBCLUSTER decision\noverrides:\n  - cluster_id: "5"\n    cell_type: "Known_Rare_Type"\n    reason: "Rare but well-characterized population"\n\n# Force subcluster even if auto said SKIP\nsubcluster:\n  - cluster_id: "8"\n    resolution: 0.4\n    reason: "Known to contain subtypes"\n\n# Prevent auto from subclustering\nskip:\n  - cluster_id: "12"\n    reason: "Low cells, do not subcluster"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"merge-behavior",children:"Merge Behavior"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Auto Decision"}),(0,l.jsx)(n.th,{children:"Manual Decision"}),(0,l.jsx)(n.th,{children:"Result"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SUBCLUSTER"}),(0,l.jsx)(n.td,{children:"Override"}),(0,l.jsx)(n.td,{children:"Override wins"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SUBCLUSTER"}),(0,l.jsx)(n.td,{children:"Skip"}),(0,l.jsx)(n.td,{children:"Skip wins"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SKIP"}),(0,l.jsx)(n.td,{children:"Subcluster"}),(0,l.jsx)(n.td,{children:"Subcluster wins"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SKIP"}),(0,l.jsx)(n.td,{children:"Override"}),(0,l.jsx)(n.td,{children:"Override wins"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Any"}),(0,l.jsx)(n.td,{children:"Merge"}),(0,l.jsx)(n.td,{children:"Merge wins"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"diagnostic-mode",children:"Diagnostic Mode"}),"\n",(0,l.jsx)(n.p,{children:"Preview the merged plan before executing:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Generate plan without executing\ncelltype-refinery refine \\\n  --input annotated.h5ad \\\n  --auto \\\n  --config curation.yaml \\\n  --out output/hybrid\n\n# Review the plan\ncat output/hybrid/merged_plan.yaml\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# merged_plan.yaml (generated)\noperations:\n  - type: override\n    cluster_id: "5"\n    cell_type: "Known_Rare_Type"\n    source: manual  # Manual override\n\n  - type: subcluster\n    cluster_id: "3"\n    resolution: 0.3\n    source: auto  # From auto policy\n\n  - type: subcluster\n    cluster_id: "8"\n    resolution: 0.4\n    source: manual  # Manual forced\n\n  - type: skip\n    cluster_id: "12"\n    source: manual  # Manual prevention\n'})}),"\n",(0,l.jsx)(n.h2,{id:"workflow-example",children:"Workflow Example"}),"\n",(0,l.jsx)(n.h3,{id:"step-1-run-auto--diagnostic",children:"Step 1: Run Auto + Diagnostic"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"celltype-refinery refine \\\n  --input annotated.h5ad \\\n  --auto \\\n  --out output/auto_diagnostic\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Review ",(0,l.jsx)(n.code,{children:"diagnostic_report.csv"})," to see auto recommendations."]}),"\n",(0,l.jsx)(n.h3,{id:"step-2-create-manual-config",children:"Step 2: Create Manual Config"}),"\n",(0,l.jsx)(n.p,{children:"Based on review, create overrides:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# curation.yaml\noverrides:\n  - cluster_id: "7"\n    cell_type: "Regulatory_T_Cells"\n    reason: "Confirmed by flow cytometry"\n\nskip:\n  - cluster_id: "15"\n    reason: "Too few cells for subclustering"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"step-3-execute-hybrid",children:"Step 3: Execute Hybrid"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"celltype-refinery refine \\\n  --input annotated.h5ad \\\n  --auto \\\n  --config curation.yaml \\\n  --execute \\\n  --out output/hybrid\n"})}),"\n",(0,l.jsx)(n.h3,{id:"step-4-review-and-iterate",children:"Step 4: Review and Iterate"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# Check results\nimport pandas as pd\n\nlog = pd.read_json("output/hybrid/curation_log.json")\nprint(log[["operation", "cluster_id", "source"]])\n'})}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Start with auto"}),": Let automation handle straightforward cases"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Target overrides"}),": Only override where you have evidence"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Document reasons"}),": Future you will thank present you"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Review merged plan"}),": Check before executing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Iterate incrementally"}),": Small changes, verify, repeat"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"iterative-refinement",children:"Iterative Refinement"})," - Multiple rounds"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../modules/refinement/policies",children:"Policy Reference"})," - Policy details"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../modules/refinement/operations",children:"Operations Reference"})," - Operation types"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>s});var i=r(6540);const l={},t=i.createContext(l);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);