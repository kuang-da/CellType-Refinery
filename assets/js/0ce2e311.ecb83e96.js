"use strict";(globalThis.webpackChunkcelltype_refinery_docs=globalThis.webpackChunkcelltype_refinery_docs||[]).push([[63],{2730(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"core-workflows/expert-curation","title":"Expert Curation Workflow","description":"The expert curation workflow gives you full manual control over cell-type assignments.","source":"@site/docs/core-workflows/expert-curation.md","sourceDirName":"core-workflows","slug":"/core-workflows/expert-curation","permalink":"/CellType-Refinery/docs/core-workflows/expert-curation","draft":false,"unlisted":false,"editUrl":"https://github.com/kuang-da/CellType-Refinery/tree/main/celltype-refinery-docs/docs/core-workflows/expert-curation.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Automated Workflow","permalink":"/CellType-Refinery/docs/core-workflows/automated-workflow"},"next":{"title":"Hybrid Workflow","permalink":"/CellType-Refinery/docs/core-workflows/hybrid-workflow"}}');var l=r(4848),i=r(8453);const s={sidebar_position:3},a="Expert Curation Workflow",o={},c=[{value:"Overview",id:"overview",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"Step 1: Initial Clustering",id:"step-1-initial-clustering",level:2},{value:"Step 2: Review Results",id:"step-2-review-results",level:2},{value:"Step 3: Create Curation Config",id:"step-3-create-curation-config",level:2},{value:"Step 4: Apply Curation",id:"step-4-apply-curation",level:2},{value:"Step 5: Iterate",id:"step-5-iterate",level:2},{value:"Operation Types",id:"operation-types",level:2},{value:"Override",id:"override",level:3},{value:"Merge",id:"merge",level:3},{value:"Subcluster",id:"subcluster",level:3},{value:"Relabel",id:"relabel",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Audit Trail",id:"audit-trail",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"expert-curation-workflow",children:"Expert Curation Workflow"})}),"\n",(0,l.jsx)(n.p,{children:"The expert curation workflow gives you full manual control over cell-type assignments."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.mermaid,{value:"flowchart LR\n    A[Clustering] --\x3e B[Review Results]\n    B --\x3e C[Create Config]\n    C --\x3e D[Apply Curation]\n    D --\x3e E{Satisfied?}\n    E --\x3e|No| B\n    E --\x3e|Yes| F[Final Results]"}),"\n",(0,l.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Publication-quality annotations required"}),"\n",(0,l.jsx)(n.li,{children:"Complex tissue with unusual populations"}),"\n",(0,l.jsx)(n.li,{children:"Marker panel has known limitations"}),"\n",(0,l.jsx)(n.li,{children:"Domain expertise available"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"step-1-initial-clustering",children:"Step 1: Initial Clustering"}),"\n",(0,l.jsx)(n.p,{children:"Run clustering and annotation to see baseline results:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Cluster\ncelltype-refinery cluster \\\n  --input merged.h5ad \\\n  --resolution 0.6 \\\n  --out output/clustered\n\n# Annotate (no refinement)\ncelltype-refinery annotate \\\n  --input output/clustered/clustered.h5ad \\\n  --marker-map markers.json \\\n  --out output/annotated\n"})}),"\n",(0,l.jsx)(n.h2,{id:"step-2-review-results",children:"Step 2: Review Results"}),"\n",(0,l.jsx)(n.p,{children:"Examine the annotation results:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nimport scanpy as sc\n\n# Load data\nadata = sc.read_h5ad("output/annotated/annotated.h5ad")\nannotations = pd.read_csv("output/annotated/cluster_annotations.csv")\n\n# Review annotations\nprint(annotations[["cluster_id", "assigned_label", "score", "stop_reason"]])\n\n# Visualize marker expression\nsc.pl.dotplot(adata, groupby="cluster_lvl0", var_names=["CD45", "EpCAM", "CD3"])\n'})}),"\n",(0,l.jsx)(n.h2,{id:"step-3-create-curation-config",children:"Step 3: Create Curation Config"}),"\n",(0,l.jsx)(n.p,{children:"Create a YAML configuration with your corrections:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# curation.yaml\nversion: "1.0"\niteration: 1\ndescription: "Expert curation for my tissue"\n\n# Direct label overrides\noverrides:\n  - cluster_id: "3"\n    cell_type: "Ciliated_Epithelium"\n    reason: "Clear FOXJ1/TUBB4A expression"\n\n  - cluster_id: "7"\n    cell_type: "Regulatory_T_Cells"\n    reason: "CD3+FOXP3+ population"\n\n# Merge over-split clusters\nmerge:\n  - source_clusters: ["5", "6"]\n    target_label: "Fibroblasts"\n    reason: "Same marker profile, split by batch"\n\n# Subcluster heterogeneous populations\nsubcluster:\n  - cluster_id: "12"\n    resolution: 0.3\n    reason: "Mixed myeloid population"\n\n# Relabel without re-clustering\nrelabel:\n  - from_cluster: "8"\n    to_label: "Smooth_Muscle_Cells"\n    reason: "Misnamed in auto-annotation"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"step-4-apply-curation",children:"Step 4: Apply Curation"}),"\n",(0,l.jsx)(n.p,{children:"Apply your configuration:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"celltype-refinery refine \\\n  --input output/annotated/annotated.h5ad \\\n  --config curation.yaml \\\n  --execute \\\n  --out output/curated\n"})}),"\n",(0,l.jsx)(n.h2,{id:"step-5-iterate",children:"Step 5: Iterate"}),"\n",(0,l.jsx)(n.p,{children:"Review results and repeat if needed:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# Load curated results\nadata = sc.read_h5ad("output/curated/refined.h5ad")\n\n# Check cell-type distribution\nprint(adata.obs["cell_type_curated"].value_counts())\n\n# Verify specific corrections\ncluster_3 = adata[adata.obs["cluster_lvl0"] == "3"]\nprint(f"Cluster 3 label: {cluster_3.obs[\'cell_type_curated\'].iloc[0]}")\n'})}),"\n",(0,l.jsxs)(n.p,{children:["If further corrections needed, create ",(0,l.jsx)(n.code,{children:"curation_v2.yaml"})," and apply:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"celltype-refinery refine \\\n  --input output/curated/refined.h5ad \\\n  --config curation_v2.yaml \\\n  --execute \\\n  --out output/curated_v2\n"})}),"\n",(0,l.jsx)(n.h2,{id:"operation-types",children:"Operation Types"}),"\n",(0,l.jsx)(n.h3,{id:"override",children:"Override"}),"\n",(0,l.jsx)(n.p,{children:"Directly assign a cell type to a cluster:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'overrides:\n  - cluster_id: "3"\n    cell_type: "My_Cell_Type"\n    reason: "Explanation"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"merge",children:"Merge"}),"\n",(0,l.jsx)(n.p,{children:"Combine multiple clusters:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'merge:\n  - source_clusters: ["5", "6", "7"]\n    target_label: "Combined_Type"\n    reason: "Explanation"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"subcluster",children:"Subcluster"}),"\n",(0,l.jsx)(n.p,{children:"Re-cluster at finer resolution:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'subcluster:\n  - cluster_id: "12"\n    resolution: 0.3\n    reason: "Explanation"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"relabel",children:"Relabel"}),"\n",(0,l.jsx)(n.p,{children:"Rename without re-clustering:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'relabel:\n  - from_cluster: "8"\n    to_label: "New_Name"\n    reason: "Explanation"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Document everything"}),": Always include ",(0,l.jsx)(n.code,{children:"reason"})," fields"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Small iterations"}),": Make a few changes, verify, repeat"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Version configs"}),": Keep ",(0,l.jsx)(n.code,{children:"curation.yaml"}),", ",(0,l.jsx)(n.code,{children:"curation_v2.yaml"}),", etc."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Preserve lineage"}),": Use cluster IDs, not cell-type names"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Review DE genes"}),": Check differential expression before overrides"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,l.jsxs)(n.p,{children:["All operations are logged in ",(0,l.jsx)(n.code,{children:"curation_log.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "timestamp": "2025-01-15T10:30:00",\n  "operation": "override",\n  "cluster_id": "3",\n  "old_label": "Unknown",\n  "new_label": "Ciliated_Epithelium",\n  "reason": "Clear FOXJ1/TUBB4A expression",\n  "n_cells": 5234\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"hybrid-workflow",children:"Hybrid Workflow"})," - Combine with automation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"../modules/refinement/operations",children:"Refinement Operations"})," - Detailed operation reference"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>a});var t=r(6540);const l={},i=t.createContext(l);function s(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);