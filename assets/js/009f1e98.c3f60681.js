"use strict";(globalThis.webpackChunkcelltype_refinery_docs=globalThis.webpackChunkcelltype_refinery_docs||[]).push([[7715],{8370(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"getting-started/configuration","title":"Configuration","description":"CellType-Refinery uses YAML configuration files for tissue-specific parameters and pipeline settings.","source":"@site/docs/getting-started/configuration.md","sourceDirName":"getting-started","slug":"/getting-started/configuration","permalink":"/CellType-Refinery/docs/getting-started/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/kuang-da/CellType-Refinery/tree/main/celltype-refinery-docs/docs/getting-started/configuration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Quickstart","permalink":"/CellType-Refinery/docs/getting-started/quickstart"},"next":{"title":"First Annotation Tutorial","permalink":"/CellType-Refinery/docs/getting-started/first-annotation"}}');var t=i(4848),s=i(8453);const l={sidebar_position:3},a="Configuration",o={},c=[{value:"Configuration Files",id:"configuration-files",level:2},{value:"Tissue Templates",id:"tissue-templates",level:3},{value:"Pipeline Configuration",id:"pipeline-configuration",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"CLI Configuration",id:"cli-configuration",level:2},{value:"Configuration Precedence",id:"configuration-precedence",level:2},{value:"Validation",id:"validation",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,t.jsx)(n.p,{children:"CellType-Refinery uses YAML configuration files for tissue-specific parameters and pipeline settings."}),"\n",(0,t.jsx)(n.mermaid,{value:'flowchart TD\n    subgraph Precedence["Configuration Precedence (later overrides)"]\n        direction TB\n        P1["1. Package defaults"]\n        P2["2. Tissue template"]\n        P3["3. Pipeline config"]\n        P4["4. Environment vars"]\n        P5["5. CLI arguments"]\n    end\n\n    P1 --\x3e P2 --\x3e P3 --\x3e P4 --\x3e P5\n\n    style P5 fill:#90EE90'}),"\n",(0,t.jsx)(n.h2,{id:"configuration-files",children:"Configuration Files"}),"\n",(0,t.jsx)(n.h3,{id:"tissue-templates",children:"Tissue Templates"}),"\n",(0,t.jsx)(n.p,{children:"Tissue-specific settings are defined in YAML templates:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# configs/tissues/my_tissue.yaml\nversion: "1.0"\ntissue: "my_tissue"\n\n# Hierarchical gating parameters\ngating:\n  # Root marker requirements\n  root_hard_requirements:\n    "Immune Cells":\n      marker: "CD45"\n      min_pos_frac: 0.30\n    "Epithelium":\n      marker: "EpCAM"\n      min_pos_frac: 0.25\n\n  # Default gating thresholds\n  defaults:\n    min_coverage: 0.3\n    min_pos_frac: 0.2\n\n# Pattern matching for cell type grouping\npatterns:\n  epithelial: ["Epithelium", "Epithelial", "Keratin"]\n  immune: ["CD45", "Immune", "Myeloid", "Lymphoid"]\n  stromal: ["Fibroblast", "Mesenchymal", "Stromal"]\n  endothelial: ["Endothelium", "CD31", "VWF"]\n\n# Regional configuration (optional)\nregions:\n  expected:\n    - name: "proximal"\n      cell_types: ["Epithelium", "Stromal"]\n    - name: "distal"\n      cell_types: ["Epithelium", "Immune Cells"]\n'})}),"\n",(0,t.jsx)(n.h3,{id:"pipeline-configuration",children:"Pipeline Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Full pipeline settings for automated runs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# configs/pipelines/full.yaml\nversion: "1.0"\nname: "full_pipeline"\n\n# Input/output paths\npaths:\n  input: "data/merged.h5ad"\n  output: "output"\n  marker_map: "configs/marker_maps/markers.json"\n  tissue_config: "configs/tissues/my_tissue.yaml"\n\n# Stage parameters\nstages:\n  clustering:\n    enabled: true\n    resolution: 0.6\n    n_pcs: 30\n    neighbors_k: 15\n    use_gpu: true\n\n  annotation:\n    enabled: true\n    layer: "batchcorr"\n\n  refinement:\n    enabled: true\n    mode: "auto"  # auto, manual, or hybrid\n    execute: true\n    score_threshold: 1.0\n    min_cells: 500\n\n  analysis:\n    composition: true\n    spatial: true\n    review: true\n'})}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:"Override configuration via environment variables:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CTR_CONFIG_DIR"})}),(0,t.jsx)(n.td,{children:"Configuration directory"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"./configs"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CTR_OUTPUT_DIR"})}),(0,t.jsx)(n.td,{children:"Default output directory"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"./output"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CTR_LOG_LEVEL"})}),(0,t.jsx)(n.td,{children:"Logging verbosity"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"INFO"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CTR_USE_GPU"})}),(0,t.jsx)(n.td,{children:"Enable GPU acceleration"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"cli-configuration",children:"CLI Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Override config file settings via CLI flags:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"celltype-refinery annotate \\\n  --input data.h5ad \\\n  --marker-map markers.json \\\n  --layer batchcorr \\\n  --min-coverage 0.3 \\\n  --min-pos-frac 0.2 \\\n  --out output/\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-precedence",children:"Configuration Precedence"}),"\n",(0,t.jsx)(n.p,{children:"Settings are applied in order (later overrides earlier):"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Package defaults"}),"\n",(0,t.jsxs)(n.li,{children:["Tissue template (",(0,t.jsx)(n.code,{children:"configs/tissues/*.yaml"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Pipeline config (",(0,t.jsx)(n.code,{children:"configs/pipelines/*.yaml"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Environment variables"}),"\n",(0,t.jsx)(n.li,{children:"CLI arguments"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,t.jsx)(n.p,{children:"Validate configuration before running:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"celltype-refinery validate-config --config pipeline.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or in Python:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from celltype_refinery.pipeline import PipelineConfig\n\nconfig = PipelineConfig.load("pipeline.yaml")\nerrors = config.validate()\nif errors:\n    for error in errors:\n        print(f"Error: {error}")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"first-annotation",children:"First Annotation"})," - Complete walkthrough"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../configuration/marker-maps",children:"Marker Maps"})," - Marker map reference"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../configuration/tissue-templates",children:"Tissue Templates"})," - Template reference"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var r=i(6540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);