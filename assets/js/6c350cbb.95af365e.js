"use strict";(globalThis.webpackChunkcelltype_refinery_docs=globalThis.webpackChunkcelltype_refinery_docs||[]).push([[537],{1415(e,s,d){d.r(s),d.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>j,frontMatter:()=>t,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"reference/output-files","title":"Output Files Reference","description":"This page describes all output files generated by Stage H (clustering and annotation) and Stage I (refinement).","source":"@site/docs/reference/output-files.md","sourceDirName":"reference","slug":"/reference/output-files","permalink":"/CellType-Refinery/docs/reference/output-files","draft":false,"unlisted":false,"editUrl":"https://github.com/kuang-da/CellType-Refinery/tree/main/celltype-refinery-docs/docs/reference/output-files.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Glossary","permalink":"/CellType-Refinery/docs/reference/glossary"},"next":{"title":"Fallopian Tube Example","permalink":"/CellType-Refinery/docs/examples/fallopian-tube"}}');var n=d(4848),i=d(8453);const t={sidebar_position:4},l="Output Files Reference",c={},h=[{value:"Stage H Outputs",id:"stage-h-outputs",level:2},{value:"coarse_clusters.h5ad",id:"coarse_clustersh5ad",level:3},{value:"cluster_annotations.csv",id:"cluster_annotationscsv",level:3},{value:"marker_scores.csv",id:"marker_scorescsv",level:3},{value:"decision_steps.csv",id:"decision_stepscsv",level:3},{value:"figures/",id:"figures",level:3},{value:"Stage I Outputs",id:"stage-i-outputs",level:2},{value:"refined.h5ad",id:"refinedh5ad",level:3},{value:"diagnostic_report.csv",id:"diagnostic_reportcsv",level:3},{value:"refinement_log.csv",id:"refinement_logcsv",level:3},{value:"File Formats",id:"file-formats",level:2},{value:"AnnData (.h5ad)",id:"anndata-h5ad",level:3},{value:"CSV Files",id:"csv-files",level:3},{value:"JSON Fields",id:"json-fields",level:3},{value:"See Also",id:"see-also",level:2}];function x(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"output-files-reference",children:"Output Files Reference"})}),"\n",(0,n.jsx)(s.p,{children:"This page describes all output files generated by Stage H (clustering and annotation) and Stage I (refinement)."}),"\n",(0,n.jsx)(s.h2,{id:"stage-h-outputs",children:"Stage H Outputs"}),"\n",(0,n.jsx)(s.p,{children:"Stage H produces the initial clustering and hierarchical cell type annotation. All outputs are written to the specified output directory."}),"\n",(0,n.jsx)(s.h3,{id:"coarse_clustersh5ad",children:"coarse_clusters.h5ad"}),"\n",(0,n.jsx)(s.p,{children:"The primary output AnnData file containing clustered and annotated cells."}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Added .obs columns:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_lvl0"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Leiden cluster ID"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_auto"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Assigned cell type label"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_auto_root"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Root category (Epithelium, Immune, etc.)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_auto_conf"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Confidence score (min margin along path)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_auto_path"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Full hierarchy path"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"DAPI_intensity"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Technical marker intensity"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"Collagen_IV_intensity"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Technical marker intensity"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"Beta_actin_intensity"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Technical marker intensity"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Added .uns keys:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Key"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"de_wilcoxon_{layer}"})}),(0,n.jsx)(s.td,{children:"Differential expression results per layer"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_h_params"})}),(0,n.jsx)(s.td,{children:"Run parameters including resolution and thresholds"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_h_gating_params"})}),(0,n.jsx)(s.td,{children:"Gating thresholds used for marker positivity"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_h_marker_map"})}),(0,n.jsx)(s.td,{children:"Compiled marker map used for annotation"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_h_timestamp"})}),(0,n.jsx)(s.td,{children:"ISO timestamp of when Stage H was run"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"cluster_annotationscsv",children:"cluster_annotations.csv"}),"\n",(0,n.jsx)(s.p,{children:"Per-cluster summary with assignment details. This file provides a human-readable overview of all cluster assignments."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_id"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Cluster identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"assigned_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Final cell type label"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"assigned_path"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:'Full hierarchy path (e.g., "Immune Cells / Lymphoids / T Cells")'})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"assigned_level"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Hierarchy depth reached (0 = root)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"assigned_score"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Score at assigned level"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"root_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Root category"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"confidence"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Min margin along path"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stop_reason"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Why descent stopped"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"n_cells"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Number of cells in cluster"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"coverage"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Marker coverage (0-1)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"resolved_markers"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Comma-separated list of markers used"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"is_ambiguous_root"})}),(0,n.jsx)(s.td,{children:"bool"}),(0,n.jsx)(s.td,{children:"True if root was ambiguous"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"composition"})}),(0,n.jsx)(s.td,{children:"JSON"}),(0,n.jsx)(s.td,{children:"Per-cell vote composition (for ambiguous clusters)"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Stop reason values:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Value"}),(0,n.jsx)(s.th,{children:"Meaning"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"leaf_reached"})}),(0,n.jsx)(s.td,{children:"Reached a terminal node in hierarchy"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"no_children_pass"})}),(0,n.jsx)(s.td,{children:"No child types passed gating threshold"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"low_margin"})}),(0,n.jsx)(s.td,{children:"Winner margin below confidence threshold"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"insufficient_coverage"})}),(0,n.jsx)(s.td,{children:"Too few markers available at next level"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"max_depth"})}),(0,n.jsx)(s.td,{children:"Reached configured maximum depth"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"marker_scorescsv",children:"marker_scores.csv"}),"\n",(0,n.jsx)(s.p,{children:"Full scoring matrix showing scores for all (cluster, cell_type) pairs. Useful for understanding why specific assignments were made."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_id"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Cluster identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Cell type label"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"path"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Hierarchy path"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"level"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Hierarchy level"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"score"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Total score"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"coverage"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Marker coverage"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"mean_enrichment"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Average Z-score"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"mean_positive_fraction"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Average positive fraction"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"frac_markers_on"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Fraction of markers above threshold"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"de_component"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"DE bonus contribution"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"anti_penalty"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Anti-marker penalty"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"resolved_markers"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Markers used"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"missing_markers"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Markers not in panel"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"n_cells"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Cluster size"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"decision_stepscsv",children:"decision_steps.csv"}),"\n",(0,n.jsx)(s.p,{children:"Step-by-step trace of hierarchical assignment decisions. Essential for debugging and understanding the decision process."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_id"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Cluster identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"step_idx"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Step number (0 = root selection)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"parent_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Parent node"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Candidate being evaluated"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_passed_gate"})}),(0,n.jsx)(s.td,{children:"bool"}),(0,n.jsx)(s.td,{children:"Whether candidate passed gating"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_score"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Candidate's score"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_coverage"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Candidate's coverage"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_pos_frac"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Candidate's positive fraction"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_enrichment"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Candidate's enrichment"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_anti_penalty"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Candidate's anti-penalty"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"selected"})}),(0,n.jsx)(s.td,{children:"bool"}),(0,n.jsx)(s.td,{children:"Whether this candidate was selected"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"margin_to_runner_up"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Score gap to second place"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"fail_reason"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Why candidate failed (if applicable)"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Fail reason values:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Value"}),(0,n.jsx)(s.th,{children:"Meaning"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"below_gate"})}),(0,n.jsx)(s.td,{children:"Score below gating threshold"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"low_coverage"})}),(0,n.jsx)(s.td,{children:"Insufficient marker coverage"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"anti_markers"})}),(0,n.jsx)(s.td,{children:"Penalized by anti-marker expression"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"outscored"})}),(0,n.jsx)(s.td,{children:"Another candidate had higher score"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"figures",children:"figures/"}),"\n",(0,n.jsx)(s.p,{children:"QC visualization plots for assessing annotation quality:"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"File"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_size_distribution.png"})}),(0,n.jsx)(s.td,{children:"Histogram of cluster sizes"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"confidence_distribution.png"})}),(0,n.jsx)(s.td,{children:"Histogram of confidence scores"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"depth_distribution.png"})}),(0,n.jsx)(s.td,{children:"Histogram of hierarchy depths reached"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stop_reason_summary.png"})}),(0,n.jsx)(s.td,{children:"Bar chart of stop reasons"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"root_composition.png"})}),(0,n.jsx)(s.td,{children:"Pie chart of root category distribution"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"marker_coverage_heatmap.png"})}),(0,n.jsx)(s.td,{children:"Heatmap of marker coverage by cluster"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"stage-i-outputs",children:"Stage I Outputs"}),"\n",(0,n.jsx)(s.p,{children:"Stage I performs iterative refinement of the initial annotations, including subclustering of heterogeneous clusters and relabeling of misannotated ones."}),"\n",(0,n.jsx)(s.h3,{id:"refinedh5ad",children:"refined.h5ad"}),"\n",(0,n.jsx)(s.p,{children:"Refined AnnData with updated annotations after one or more refinement iterations."}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Added/modified .obs columns:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_lvl1"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:'Refined cluster ID (may include subclusters like "3:0", "3:1")'})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_lvl1"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Refined cell type label"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cell_type_lvl0"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Original Stage H label (preserved)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"refinement_action"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Action taken (SUBCLUSTER, RELABEL, KEEP)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"refinement_iteration"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Iteration when this cell was last modified"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Added .uns keys:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Key"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_refine_iteration_N"})}),(0,n.jsx)(s.td,{children:"Provenance for iteration N"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_i_params"})}),(0,n.jsx)(s.td,{children:"Refinement parameters used"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stage_i_summary"})}),(0,n.jsx)(s.td,{children:"Summary statistics of refinement"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Provenance structure (stage_refine_iteration_N):"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:'{\n    "timestamp": "2024-01-15T10:30:00",\n    "clusters_processed": 45,\n    "subclustered": ["3", "7", "12"],\n    "relabeled": {"5": "B Cells", "9": "Macrophages"},\n    "skipped": ["1", "2", "4"],\n    "parameters": {...}\n}\n'})}),"\n",(0,n.jsx)(s.h3,{id:"diagnostic_reportcsv",children:"diagnostic_report.csv"}),"\n",(0,n.jsxs)(s.p,{children:["Recommendations from diagnostic mode. Generated when running Stage I with ",(0,n.jsx)(s.code,{children:"--diagnostic"})," flag."]}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_id"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Cluster identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"current_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Current assignment"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"recommendation"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"SUBCLUSTER, RELABEL, or SKIP"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"reason"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Why this recommendation"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"criterion"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Which AutoPolicy criterion matched"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"best_child"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Best child type (for RELABEL)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"child_score"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Best child's score"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"heterogeneity_score"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Cluster heterogeneity measure"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"n_cells"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Number of cells in cluster"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"priority"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Suggested processing order"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Recommendation values:"})}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Value"}),(0,n.jsx)(s.th,{children:"Meaning"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"SUBCLUSTER"})}),(0,n.jsx)(s.td,{children:"Cluster is heterogeneous, should be split"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"RELABEL"})}),(0,n.jsx)(s.td,{children:"Cluster can be assigned to a more specific type"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"SKIP"})}),(0,n.jsx)(s.td,{children:"No refinement needed"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"refinement_logcsv",children:"refinement_log.csv"}),"\n",(0,n.jsx)(s.p,{children:"Detailed log of all refinement actions taken across iterations."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"iteration"})}),(0,n.jsx)(s.td,{children:"int"}),(0,n.jsx)(s.td,{children:"Refinement iteration number"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"cluster_id"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Original cluster identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"action"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Action taken"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"old_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Label before refinement"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"new_label"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Label after refinement"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"new_clusters"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Comma-separated list of new cluster IDs (for SUBCLUSTER)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"confidence_before"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Confidence before action"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"confidence_after"})}),(0,n.jsx)(s.td,{children:"float"}),(0,n.jsx)(s.td,{children:"Confidence after action"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"timestamp"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"ISO timestamp"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"file-formats",children:"File Formats"}),"\n",(0,n.jsx)(s.h3,{id:"anndata-h5ad",children:"AnnData (.h5ad)"}),"\n",(0,n.jsxs)(s.p,{children:["All ",(0,n.jsx)(s.code,{children:".h5ad"})," files use the standard AnnData HDF5 format:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Compatible with scanpy and anndata Python packages"}),"\n",(0,n.jsxs)(s.li,{children:["Can be read with ",(0,n.jsx)(s.code,{children:"anndata.read_h5ad()"})]}),"\n",(0,n.jsx)(s.li,{children:"Stores expression matrices, cell/gene metadata, and analysis results"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"csv-files",children:"CSV Files"}),"\n",(0,n.jsx)(s.p,{children:"All CSV files use:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"UTF-8 encoding"}),"\n",(0,n.jsx)(s.li,{children:"Comma delimiter"}),"\n",(0,n.jsx)(s.li,{children:"First row as header"}),"\n",(0,n.jsx)(s.li,{children:"Double-quote escaping for fields containing commas"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"json-fields",children:"JSON Fields"}),"\n",(0,n.jsx)(s.p,{children:"Some CSV columns contain JSON-encoded data:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Parse with standard JSON libraries"}),"\n",(0,n.jsx)(s.li,{children:"Always valid JSON (not Python dict syntax)"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"/CellType-Refinery/docs/methodology/annotation-pipeline",children:"Annotation Pipeline"})," - Pipeline overview"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"/CellType-Refinery/docs/cli/overview",children:"CLI Reference"})," - Command options"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"/CellType-Refinery/docs/configuration/marker-maps",children:"Marker Maps Configuration"})," - Input marker map format"]}),"\n"]})]})}function j(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(x,{...e})}):x(e)}},8453(e,s,d){d.d(s,{R:()=>t,x:()=>l});var r=d(6540);const n={},i=r.createContext(n);function t(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);