# Review Template for Cell-Type Annotation Validation
# ====================================================
# This template defines tissue-specific expectations for the review module.
# Copy and customize for your tissue type.

version: "1.0"
tissue: "template"

# Cell Type Expectations
# ----------------------
# Define expected characteristics for each cell type.
# All percentages are in range 0-100.

cell_types:
  Epithelium:
    expected_pct: [20, 60]        # Expected global percentage range
    expected_moran: [0.2, 0.5]    # Expected Moran's I range (spatial clustering)
    expected_regions:
      region_a: [30, 70]          # Expected percentage in region_a
      region_b: [10, 30]
    canonical_markers:
      - Pan-CK
      - E-cadherin
    excluded_markers:
      - CD45
      - Vimentin
    notes: "Main epithelial compartment"

  Stromal:
    expected_pct: [15, 40]
    expected_moran: [0.15, 0.4]
    expected_regions:
      region_a: [20, 50]
      region_b: [30, 60]
    canonical_markers:
      - Vimentin
    notes: "Fibroblasts and other stromal cells"

  Immune Cells:
    expected_pct: [5, 20]
    expected_moran: [0.1, 0.3]
    canonical_markers:
      - CD45
    notes: "All immune cell populations"

  Endothelium:
    expected_pct: [3, 15]
    expected_moran: [0.3, 0.6]
    canonical_markers:
      - CD31
      - VWF
    notes: "Blood and lymphatic endothelium"

# Regional Expectations
# ---------------------
# Define expected cell type patterns per region.

regions:
  region_a:
    dominant_types:
      - Epithelium
    rare_types:
      - Smooth Muscle Cells
    biology_metrics:
      epithelial_stromal_ratio: [0.5, 3.0]

  region_b:
    dominant_types:
      - Stromal
    rare_types:
      - Epithelium
    biology_metrics:
      epithelial_stromal_ratio: [0.1, 0.5]

# Biology Rules
# -------------
# Tissue-specific biology rules for validation.
# These rules are config-driven and can be customized per tissue.

biology_rules:
  enabled: true
  rules:
    # Ratio-based rule (E:S ratio check)
    - rule_id: "RATIO_VIOLATION"
      metric_name: "epithelial_stromal_ratio"
      description: "Epithelial:Stromal ratio check"
      regional_thresholds:
        region_a: [0.5, 3.0]
        region_b: [0.1, 0.5]

    # Regional minimum rule
    - rule_id: "REGIONAL_METRIC_LOW"
      region: "region_a"
      cell_types: ["Epithelium"]
      min_pct: 25.0
      description: "Region A should have high epithelial coverage"

    # Regional gradient rule
    - rule_id: "REGIONAL_GRADIENT_ABSENT"
      cell_types: ["Epithelium", "Stromal"]
      min_cv: 0.3
      description: "These cell types should vary across regions"

# Quality Thresholds
# ------------------
# Thresholds for annotation quality rules.

quality_thresholds:
  max_unassigned_pct: 10.0         # Max acceptable unassigned percentage
  max_hybrid_pct: 5.0              # Max acceptable hybrid type percentage
  max_low_confidence_pct: 20.0    # Max acceptable low-confidence percentage

# Known Artifacts
# ---------------
# Patterns known to indicate annotation problems.

known_artifacts:
  - name: "sample-concentrated"
    description: "Cell type concentrated in single sample indicates batch effect"
    detection_method: "sample_concentration"
    threshold: 0.5
    recommendation: "Investigate for sample-specific artifact or batch effect"

  - name: "extreme-clustering"
    description: "Extreme spatial clustering may indicate segmentation artifacts"
    detection_method: "extreme_clustering"
    threshold: 0.8
    recommendation: "Check for segmentation artifacts or autofluorescent debris"

  - name: "low-assignment"
    description: "High unassigned rate indicates marker map issues"
    detection_method: "low_assignment"
    threshold: 0.15
    recommendation: "Review marker map and annotation thresholds"
